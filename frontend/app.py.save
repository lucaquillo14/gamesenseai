import 
streamlit as st
import os
from pathlib import Path
import firebase_admin
from firebase_admin import credentials, firestore, auth

# --- Initialize Firebase ---
if not firebase_admin._apps:
    cred = credentials.Certificate("../serviceAccountKey.json")
    firebase_admin.initialize_app(cred)

db = firestore.client()

# --- Directories ---
UPLOAD_DIR = Path("data")
UPLOAD_DIR.mkdir(exist_ok=True)

# --- App UI ---
st.title("⚽ GameSense AI - MVP")

# 1️⃣ Simulated Login
st.subheader("Login Simulation")
email = st.text_input("Email")
password = st.text_input("Password", type="password")

if st.button("Login"):
    try:
        user = auth.get_user_by_email(email)
        st.success(f"Logged in as {email}")
        st.session_state["user"] = email
    except:
        st.error("User not found or invalid credentials.")

if "user" in st.session_state:
    st.subheader("Welcome!")
    st.write(f"Logged in as: {st.session_state['user']}")

    # 2️⃣ Upload Video
    uploaded_file = st.file_uploader("Upload a training video", type=["mp4", "mov"])
    if uploaded_file is not None:
        save_path = UPLOAD_DIR / uploaded_file.name
        with open(save_path, "wb") as f:
            f.write(uploaded_file.getbuffer())
        st.success(f"Saved video: {uploaded_file.name}")

    # 3️⃣ List Uploaded Videos
    st.subheader("Uploaded Videos")
    video_files = os.listdir(UPLOAD_DIR)
    if video_files:
        for video in video_files:
            st.video(str(UPLOAD_DIR / video))
            # Placeholder AI feedback
            st.info("AI Feedback: [This is a placeholder for your AI insights]")
    else:
        st.write("No videos uploaded yet.")

